import numpy as np
import pandas as pd
import streamlit as st
from sklearn.neural_network import MLPClassifier

st.set_page_config(page_title="BUDAPrototype", page_icon="üåÄ")

# Define o t√≠tulo do aplicativo
st.title("Prevendo n√∫meros da Lotof√°cil")

# carrega os dados de treinamento
dados_treinamento = pd.read_csv('sequencias.csv')

# extrai as sequ√™ncias e os r√≥tulos
X = dados_treinamento.values[:, :-1]
y = dados_treinamento.values[:, -1]

# cria o modelo MLP
model = MLPClassifier(hidden_layer_sizes=(30, 20, 10), max_iter=1000)

# treina o modelo
model.fit(X, y)

# solicita que o usu√°rio insira a sequ√™ncia a ser prevista
nova_sequencia_str = st.text_input("Digite os 15 n√∫meros da sequ√™ncia a ser prevista, separados por v√≠rgula (ex: 1,2,3,...,15): ")

# adiciona um bot√£o para prever os n√∫meros
if st.button("Prever"):
    if nova_sequencia_str:
        nova_sequencia = list(map(int, nova_sequencia_str.split(',')))
        if len(nova_sequencia) != 15:
            st.error("A sequ√™ncia deve conter exatamente 15 n√∫meros!")
        elif not all(1 <= numero <= 25 for numero in nova_sequencia):
            st.error("A sequ√™ncia deve conter apenas n√∫meros no intervalo de 1 a 25!")
        else:
            # obt√©m os √≠ndices das posi√ß√µes em ordem decrescente de probabilidade
            probabilidades = model.predict_proba([nova_sequencia])[0]
            indices_previstos = np.argsort(probabilidades)[::-1]

            # seleciona os 15 n√∫meros com maior probabilidade no intervalo de 1 a 25
            numeros_previstos = []
            for indice in indices_previstos:
                numero_previsto = indice + 1
                if numero_previsto not in numeros_previstos and numero_previsto <= 25:
                    numeros_previstos.append(numero_previsto)
                if len(numeros_previstos) == 15:
                    break

            # ordena os n√∫meros previstos na ordem crescente
            numeros_previstos = sorted(numeros_previstos)

            # exibe os n√∫meros previstos em um ret√¢ngulo com bordas arredondadas
            st.markdown(
                f"""
                        <div style="background-color:white; border-radius: 20px; padding: 10px; width: 750px; display: flex; justify-content: center; align-items: center;">
                            <div style="display: flex; justify-content: flex-end; align-items: center; margin-left: 10px;">
                                {" ".join([f'<div style="background-color:green; color:white; font-size: 20px; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center;">{num}</div><div style="width: 10px;"></div>' for num in numeros_previstos])}
                            </div>
                        </div>
                        """,
                unsafe_allow_html=True
            )
